-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

-- Variables
local client = Players.LocalPlayer
local Items = Workspace:FindFirstChild("Items")
local Rooms = Workspace:FindFirstChild("House") and Workspace.House:FindFirstChild("Rooms")
local GhostRoom = {}
local IsReady = false
local hasTeleported = false  -- Flag to track if teleportation has already occurred

-- Functions
local function log(message)
    print("[SCRIPT]: " .. message)
end

-- Function to create or update GUI for teleport buttons
local function createTeleportFrame()
    -- Create new frame
    local teleportFrame = Instance.new("ScrollingFrame")
    teleportFrame.Size = UDim2.new(0, 200, 0, 200)  -- Adjusted size
    teleportFrame.Position = UDim2.new(1, -210, 1, -210)  -- Bottom-right position with offset
    teleportFrame.BackgroundTransparency = 0.5
    teleportFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    teleportFrame.BorderSizePixel = 2
    teleportFrame.ScrollBarThickness = 8  -- Add scroll bar for navigation
    teleportFrame.Parent = game.Players.LocalPlayer.PlayerGui.ScreenGui

    -- Create UIListLayout for buttons
    local uiListLayout = Instance.new("UIListLayout")
    uiListLayout.FillDirection = Enum.FillDirection.Vertical
    uiListLayout.Padding = UDim.new(0, 5)  -- Padding between buttons
    uiListLayout.Parent = teleportFrame

    return teleportFrame
end

local function addButtonToFrame(frame, name, callback)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -10, 0, 30)  -- Adjusted size
    button.Position = UDim2.new(0, 5, 0, 5)  -- Position with padding
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = name
    button.Font = Enum.Font.SourceSans
    button.TextSize = 14
    button.Parent = frame

    button.MouseButton1Click:Connect(callback)
end

-- Initialize the teleport buttons
function initTeleport()
    local teleportFrame = createTeleportFrame()
    
    -- Van Button
    addButtonToFrame(teleportFrame, "Van", function()
        local VanSpawn = workspace:FindFirstChild('House') and workspace.House:FindFirstChild('VanSpawn')
        local Humanoid, HRoot = (client.Character and client.Character:FindFirstChildOfClass('Humanoid')), (client.Character and (client.Character.PrimaryPart or client.Character:FindFirstChild('HumanoidRootPart')))
        if not client.Character:FindFirstChildOfClass('Humanoid').Sit then client.Character.Humanoid.Sit = true end
        if VanSpawn then
            HRoot.CFrame = VanSpawn.CFrame - Vector3.new(0, 4, 0)
        end
    end)

    -- Room Buttons
    local index = 1
    for _, room in pairs(Rooms:GetChildren()) do
        local RoomName = room:IsA('Folder') and room:FindFirstChild('RoomName') and room.RoomName.Value
        if RoomName then
            addButtonToFrame(teleportFrame, RoomName, function()
                local Humanoid, HRoot = (client.Character and client.Character:FindFirstChildOfClass('Humanoid')), (client.Character and (client.Character.PrimaryPart or client.Character:FindFirstChild('HumanoidRootPart')))
                if not client.Character:FindFirstChildOfClass('Humanoid').Sit then client.Character.Humanoid.Sit = true end

                local Hitbox = room:IsA('Folder') and room:FindFirstChild('Hitbox')
                if Hitbox then
                    HRoot.CFrame = Hitbox.CFrame
                end
            end)
            index = index + 1
        end
    end
end

-- Initialize GUI
coroutine.wrap(initTeleport)()
