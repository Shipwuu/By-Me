-- Services
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")

-- Variables
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Function to protect GUI if not already protected
if not pcall(function() return syn.protect_gui end) then
    syn = {}
    syn.protect_gui = function(gui)
        gui.Parent = CoreGui
    end
end

-- Adjust game settings
game:GetService("Workspace").FallenPartsDestroyHeight = -50000
Lighting.Brightness = 2
Lighting.GlobalShadows = false
Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
Lighting.Ambient = Color3.fromRGB(128, 128, 128)
Lighting.FogEnd = 100000

-- Remove atmospheres from lighting
for _, descendant in pairs(Lighting:GetDescendants()) do
    if descendant:IsA("Atmosphere") then
        descendant:Destroy()
    end
end

-- Function to create billboard GUI for orbs
local function createOrbGUI(orb)
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Adornee = orb
    billboardGui.Size = UDim2.new(0, 100, 0, 150)
    billboardGui.StudsOffset = Vector3.new(0, 1, 0)
    billboardGui.AlwaysOnTop = true
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = billboardGui
    textLabel.BackgroundTransparency = 1
    textLabel.Position = UDim2.new(0, 0, 0, -50)
    textLabel.Size = UDim2.new(0, 100, 0, 100)
    textLabel.Font = Enum.Font.SourceSansSemibold
    textLabel.TextSize = 14
    textLabel.TextColor3 = Color3.fromRGB(30, 144, 255)
    textLabel.TextStrokeTransparency = 0
    textLabel.TextYAlignment = Enum.TextYAlignment.Bottom
    textLabel.Text = "Orb"
    textLabel.ZIndex = 10
    
    local function updatePosition()
        local viewportPoint = Workspace.CurrentCamera:WorldToViewportPoint(orb.Orb.Position)
        if viewportPoint then
            textLabel.Position = Vector2.new(viewportPoint.X, viewportPoint.Y)
            textLabel.Visible = true
        else
            textLabel.Visible = false
        end
    end
    
    updatePosition()
    local orbRenderStepped = RunService.RenderStepped:Connect(updatePosition)
    
    return billboardGui
end

-- Function to create billboard GUI for EMF parts
local function createEmfGUI(part, color, text)
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Adornee = part
    billboardGui.Size = UDim2.new(0, 100, 0, 150)
    billboardGui.StudsOffset = Vector3.new(0, 1, 0)
    billboardGui.AlwaysOnTop = true
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = billboardGui
    textLabel.BackgroundTransparency = 1
    textLabel.Position = UDim2.new(0, 0, 0, -50)
    textLabel.Size = UDim2.new(0, 100, 0, 100)
    textLabel.Font = Enum.Font.SourceSansSemibold
    textLabel.TextSize = 14
    textLabel.TextColor3 = color
    textLabel.TextStrokeTransparency = 0
    textLabel.TextYAlignment = Enum.TextYAlignment.Bottom
    textLabel.Text = text
    textLabel.ZIndex = 10
    
    local function updatePosition()
        local viewportPoint = Workspace.CurrentCamera:WorldToViewportPoint(part.Position)
        if viewportPoint then
            textLabel.Position = Vector2.new(viewportPoint.X, viewportPoint.Y)
            textLabel.Visible = true
        else
            textLabel.Visible = false
        end
    end
    
    updatePosition()
    local emfRenderStepped = RunService.RenderStepped:Connect(updatePosition)
    
    return billboardGui
end

-- Create GUI using external script
local function createGUI()
    local guiScript = loadstring(game:HttpGet("https://raw.githubusercontent.com/DashaBars/Hack/main/Gui"))
    if guiScript then
        local gui = guiScript()
        
        -- Window for Specter
        local specterWindow = gui:Window("Specter")
        specterWindow.Position = UDim2.new(1, -300, 0, 10)  -- Adjust position as needed
        
        -- Window for Spirit box
        local spiritBoxWindow = gui:Window("Spirit box")
        
        -- Keybind for P
        gui:Keybind("P")
        
        -- Button functions for Specter window
        specterWindow:Button("Sanity check", function()
            local sanity = LocalPlayer.Data:FindFirstChild("Sanity")
            game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
                Text = "Sanity: " .. math.floor(sanity.Value),
                Color = Color3.fromRGB(70, 130, 180),
                Font = Enum.Font.SourceSansBold,
                FontSize = Enum.FontSize.Size24
            })
        end)
        
        specterWindow:Button("Not Alone", function()
            LocalPlayer.Data.Alone.Value = false
        end)
        
        specterWindow:Button("Alone", function()
            LocalPlayer.Data.Alone.Value = true
        end)
        
        specterWindow:Button("TpToGhostRoom", function()
            HumanoidRootPart.CFrame = Workspace.emfpart2.CFrame
        end)
        
        specterWindow:Button("TpToFuse", function()
            HumanoidRootPart.CFrame = Workspace.House.FuseBox.CFrame
        end)
        
        specterWindow:Button("TpToBone", function()
            HumanoidRootPart.CFrame = Workspace.House.Bone.CFrame + Vector3.new(0, 2, 0)
        end)
        
        specterWindow:Button("TpToVan", function()
            HumanoidRootPart.CFrame = Workspace.Van.Spawn.CFrame + Vector3.new(0, 3, 0)
        end)
        
        -- Button functions for Spirit box window
        spiritBoxWindow:Button("All words", function()
            local words = {
                "Hello? Anyone here? Someone there? How old are you? Where are you? Are you here? Are you old? Are you a man? Are you a women? Show us a sign, Give us a sign, Are you there?",
                "All"
            }
            ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(unpack(words))
        end)
        
        local spiritBoxButtons = {
            "Hello?", "Someone there?", "Anyone here?", "How old?",
            "Where are you?", "Are you here?", "Show us a sign",
            "Give us a sign", "Are you there?", "Are you here?",
            "Are you old?", "Are you a women?", "Are you a man?"
        }
        
        for _, word in ipairs(spiritBoxButtons) do
            spiritBoxWindow:Button(word, function()
                local words = { word, "All" }
                ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(unpack(words))
            end)
        end
    else
        error("Failed to load GUI script")
    end
end

-- Create GUI
createGUI()

-- Create billboard GUIs for orbs and EMF parts
for _, orb in pairs(Workspace:GetChildren()) do
    if orb.Name == "Orb" then
        createOrbGUI(orb)
    end
end

Workspace.ChildAdded:Connect(function(child)
    if child.Name == "Orb" then
        createOrbGUI(child)
    elseif child.Name == "emfpart5" then
        createEmfGUI(child, Color3.fromRGB(255, 0, 0), "Emf5")
    elseif child.Name == "emfpart3" then
        createEmfGUI(child, Color3.fromRGB(255, 140, 0), "Emf3")
    elseif child.Name == "emfpart4" then
        createEmfGUI(child, Color3.fromRGB(255, 69, 0), "Emf4")
    end
end)
